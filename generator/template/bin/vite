#!/usr/bin/env node

const path = require('path')
const spawn = require('cross-spawn')
const yargs = require('yargs/yargs')

const configPath = require.resolve('<%- pkgName %>/config/index.ts')
const cwd = path.resolve(__dirname, '../')

const { configFile = 'vue.config.js' } = yargs(process.argv).argv || {}

// Set the framework config file used by the project
process.env.FRAMEWORK_CLI_CONFIG_FILE = configFile

const params = [
  `${process.env.BUILD ? 'build' : ''}`,
  process.env.VITE_DEBUG ? '--debug' : '',
  '--config',
  `${configPath}`,
].filter(Boolean)

console.log(`running: vite ${params.join(' ')}`)
const serveService = spawn('vite', params, {
  cwd,
  stdio: 'inherit',
})

serveService.on('close', (code) => {
  process.exit(code)
})
